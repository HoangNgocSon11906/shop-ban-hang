<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.shop.holomen.infrastructure.datasource.mapper.thanhToan.ThanhToanMapper">

    <insert id="insertKhachHang" parameterType="com.shop.holomen.domain.thanhtoan.KhachHang"
            useGeneratedKeys="true" keyProperty="khachId">
        INSERT INTO shop.thong_tin_khach (
        ten,
        SDT,
        dia_chi
        )
        values (
        #{khachHang.hoVaten},
        #{khachHang.sdt},
        #{khachHang.diaChi}
        )
    </insert>

    <insert id="insertOrder" parameterType="com.shop.holomen.domain.thanhtoan.KhachHang"
            useGeneratedKeys="true" keyProperty="orderId">
        INSERT INTO shop.Order (
        khach_id,
        tong_tien,
        phi_ship,
        status
        )
        values (
        #{khachHang.khachId},
        #{khachHang.tongTien},
        #{khachHang.phiShip},
        "Chờ Xác Nhận"
        )
    </insert>

    <insert id="insertDonHang">
        INSERT INTO shop.order_detail(
        ten_san_pham,
        size,
        mau,
        gia,
        so_luong,
        order_id
        )
        values (
        #{sanPham.tenSanPham},
        #{sanPham.size},
        #{sanPham.mau},
        #{sanPham.giaSP},
        #{sanPham.soLuong},
        #{id}
        )
    </insert>

    <resultMap id="sanPham" type="com.shop.holomen.domain.thanhtoan.SanPham">
            <id property="sanPhamDetailId" column="order_detail_id"></id>
            <result property="tenSanPham" column="ten_san_pham"></result>
            <result property="giaSP" column="gia"></result>
            <result property="mau" column="mau"></result>
            <result property="size" column="size"></result>
            <result property="soLuong" column="so_luong"></result>
    </resultMap>
    <resultMap id="khachHang" type="com.shop.holomen.domain.thanhtoan.KhachHang">
        <result property="khachId" column="khach_id"></result>
        <result property="hoVaten" column="ten"></result>
        <result property="sdt" column="SDT"></result>
        <result property="diaChi" column="dia_chi"></result>
        <result property="tongTien" column="tong_tien"></result>
        <result property="phiShip" column="phi_ship"></result>
        <result property="status" column="status"></result>
        <result property="orderId" column="order_id"></result>
        <result property="ngayMua" column="update_date"></result>
    </resultMap>
    <select id="findBy" resultMap="khachHang">
    SELECT
        order_id,
        khach_id,
        ten,
        SDT,
        dia_chi,
        tong_tien,
        phi_ship,
        status,
        thong_tin_khach.update_date
    FROM shop.thong_tin_khach
    JOIN shop.order USING (khach_id)
    where khach_id = #{id}
    </select>

    <select id="findSanPham" resultMap="sanPham">
    SELECT
        order_detail_id,
        ten_san_pham,
        size,
        mau,
        gia,
        so_luong
    FROM
    shop.order_detail
    where order_id = #{id}
    </select>

</mapper>
